---

/**
 * @component TimePicker
 * @description Selector de hora compuesto (Dos dropdowns: Horas y Minutos).
 * * MOTIVACIÓN TÉCNICA:
 * - Reemplaza al `<input type="time">` nativo para evitar inconsistencias de UI entre navegadores
 * (Safari vs Chrome) y forzar el formato estricto "HH:MM" sin segundos.
 * * FUNCIONAMIENTO:
 * - Renderiza dos elementos `<select>` visibles para el usuario.
 * - Utiliza un script interno (`TimePickerLogic`) que escucha los cambios y concatena
 * los valores en un `<input type="hidden">`, que es el que finalmente se envía al servidor.
 * * PROPS:
 * @prop {string} label - Etiqueta principal.
 * @prop {string} name - Nombre del campo (se asigna al input oculto).
 * @prop {string} [subLabel] - Texto de ayuda secundario con color temático.
 * @prop {string} [color='blue'] - Tema de color para el subtexto.
 */

interface Props {
    label: string;
    subLabel?: string;
    name: string;
    required?: boolean;
    color?: 'blue' | 'purple' | 'emerald';
}

const { label, subLabel, name, required = false, color = 'blue' } = Astro.props;

const hours = Array.from({ length: 24 }, (_, i) => i.toString().padStart(2, '0'));
const minutes = Array.from({ length: 60 }, (_, i) => i.toString().padStart(2, '0'));

// Mapa de colores
const textColors = {
    blue: "text-blue-600",
    purple: "text-purple-600",
    emerald: "text-emerald-600"
};
const textColorClass = textColors[color] || textColors.blue;
---

<div class="mb-6 time-picker-component" data-name={name}>
    
    <label class="block mb-1 text-lg font-medium text-gray-900">
        {label} {required && <span class="text-red-600">*</span>}
    </label>

    {/* Color dinámico */}
    {subLabel && (
        <p class={`text-sm italic mb-3 ${textColorClass}`}>{subLabel}</p>
    )}

    <div class="flex items-center gap-2">
        
        {/* Selector de HORAS */}
        <div class="relative w-24">
        <select class="hour-select w-full bg-gray-50 border border-gray-300 text-gray-900 text-md rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2 appearance-none text-center cursor-pointer">
            <option value="" disabled selected>HH</option>
            {hours.map((h) => (
            <option value={h}>{h}</option>
            ))}
        </select>
        {/* Flechita personalizada para estilo */}
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
        </div>
        </div>

        <span class="text-2xl font-bold text-gray-400">:</span>

        {/* Selector de MINUTOS */}
        <div class="relative w-24">
        <select class="minute-select w-full bg-gray-50 border border-gray-300 text-gray-900 text-md rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2 appearance-none text-center cursor-pointer">
            <option value="" disabled selected>MM</option>
            {minutes.map((m) => (
            <option value={m}>{m}</option>
            ))}
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
        </div>
        </div>

        <span class="text-sm text-gray-500 ml-2">hrs</span>

        {/* INPUT OCULTO: Este es el que realmente se envía al servidor */}
        <input type="hidden" name={name} class="real-input" required={required} />
    
    </div>
</div>

<script>
    // Lógica para actualizar el input hidden cuando cambian los selects
    class TimePickerLogic {

        container: Element;
        hourSelect: HTMLSelectElement;
        minuteSelect: HTMLSelectElement;
        hiddenInput: HTMLInputElement;

        constructor(element: any) {
        this.container = element;
        this.hourSelect = element.querySelector('.hour-select');
        this.minuteSelect = element.querySelector('.minute-select');
        this.hiddenInput = element.querySelector('.real-input');

        this.addListeners();
        }

        addListeners() {
        const updateValue = () => {
            const h = this.hourSelect.value;
            const m = this.minuteSelect.value;
            
            // Solo actualizamos si ambos tienen valor
            if (h && m) {
            this.hiddenInput.value = `${h}:${m}`;
            } else {
            this.hiddenInput.value = '';
            }
        };

        this.hourSelect.addEventListener('change', updateValue);
        this.minuteSelect.addEventListener('change', updateValue);
        }
    }

    // Inicializar todos los pickers de la página
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.time-picker-component').forEach(el => {
        new TimePickerLogic(el);
        });
    });
</script>